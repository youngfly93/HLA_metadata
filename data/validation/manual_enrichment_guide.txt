================================================================================
SysteMHC手动数据补充操作指南
================================================================================

概述：
本指南将帮助您手动从SysteMHC补充38个数据集的详细信息。
预计时间：1.5-2小时（可分多次完成）
完成后预期效果：Disease Unknown从38个降至11个（改善71%）


一、准备工作
--------------------------------------------------------------------------------

1. 打开以下文件：
   文件路径: data/validation/systemhc_manual_template.csv
   使用Excel或任何CSV编辑器打开

2. 文件包含以下列：
   • dataset_id - 数据集ID
   • repository - 来源数据库
   • title - 数据集标题
   • systemhc_url - SysteMHC页面链接
   • hla_alleles_found - [待填写] HLA等位基因
   • tissues_found - [待填写] 组织类型
   • cell_types_found - [待填写] 细胞类型
   • diseases_found - [待填写] 疾病类型
   • notes - [可选] 备注


二、操作步骤（针对每个数据集）
--------------------------------------------------------------------------------

步骤1：访问SysteMHC页面
------------------------
从CSV中复制"systemhc_url"列的链接，在浏览器中打开。

示例：https://systemhc.sjtu.edu.cn/dataset/?dataset_id=PXD001898


步骤2：查看数据集表格
----------------------
页面加载后，您将看到一个包含以下列的表格：
• SampleID
• NumReplicates
• Organism
• TissueType
• CellType
• MHCAllele

[注意] 如果表格为空，可能该数据集在SysteMHC中信息不完整，可跳过。


步骤3：提取HLA等位基因（hla_alleles_found列）
---------------------------------------------
从"MHCAllele"列中：
• 复制所有不同的HLA等位基因
• 用分号分隔多个等位基因

示例：
  HLA-A*02:01; HLA-B*07:02; HLA-C*07:02

Tips：
• 如果有多个样本，收集所有不同的等位基因
• 不需要包含重复的
• 保持原始格式（HLA-A*02:01格式）


步骤4：提取组织类型（tissues_found列）
---------------------------------------
从"TissueType"列中：
• 复制主要的组织类型
• 多个类型用逗号分隔

示例：
  Tumor, Breast tissue
  或
  Spleen, Liver


步骤5：提取细胞类型（cell_types_found列）
------------------------------------------
从"CellType"列中：
• 复制细胞系名称或细胞类型
• 多个类型用逗号分隔

示例：
  Jurkat
  或
  C1R, LCL


步骤6：推断疾病类型（diseases_found列）
---------------------------------------
根据以下信息综合判断：
1. 页面上的项目描述
2. 组织类型（如Tumor tissue → Cancer）
3. 细胞类型
4. 数据集标题

常见疾病类型示例：
• Melanoma - 黑色素瘤
• Breast cancer - 乳腺癌
• Leukemia - 白血病
• Multiple sclerosis - 多发性硬化症
• Healthy - 健康对照

Tips：
• 如果不确定，可以参考原始的title列
• 可以填写多个疾病，用分号分隔
• 如果确实无法判断，可以留空


步骤7：添加备注（notes列，可选）
--------------------------------
记录任何有用的信息，如：
• "Data quality looks good"
• "Multiple diseases studied"
• "Incomplete information in SysteMHC"


三、填写示例
--------------------------------------------------------------------------------

示例1: PXD001898
----------------
dataset_id: PXD001898
systemhc_url: https://systemhc.sjtu.edu.cn/dataset/?dataset_id=PXD001898

查看页面后填写：
hla_alleles_found: HLA-A*02:01; HLA-A*24:02; HLA-B*07:02; HLA-C*07:02
tissues_found: Tumor, Normal tissue
cell_types_found:
diseases_found: Melanoma
notes: Global proteogenomic analysis


示例2: PXD012308
----------------
dataset_id: PXD012308
systemhc_url: https://systemhc.sjtu.edu.cn/dataset/?dataset_id=PXD012308

查看页面后填写：
hla_alleles_found: HLA-DRB1*01:01; HLA-DRB1*03:01; HLA-DQA1*05:01
tissues_found: Tumor
cell_types_found:
diseases_found: Cancer
notes: HLA-II motif study


四、批量处理建议
--------------------------------------------------------------------------------

建议顺序：
1. 先处理PRIDE (PXD)数据集（26个）- 信息通常较完整
2. 再处理MassIVE (MSV)数据集（10个）
3. 最后处理jPOST和PASS（4个）

时间分配：
• 简单数据集：2-3分钟/个
• 复杂数据集：5-8分钟/个
• 平均：3-4分钟/个

可以分段完成：
• 第一次：处理前10个（30-40分钟）
• 第二次：处理10-20个（30-40分钟）
• 第三次：处理剩余的（30-40分钟）


五、完成后
--------------------------------------------------------------------------------

保存CSV文件后，运行以下命令合并数据：

```bash
python3 scripts/merge_manual_systemhc.py
```

该脚本会：
✓ 读取您填写的模板
✓ 自动合并到主数据集
✓ 生成详细的更新报告
✓ 保存新文件：all_metadata_manually_enriched.csv

然后更新Excel报告：

```bash
python3 scripts/generate_excel.py
```


六、质量检查
--------------------------------------------------------------------------------

填写完成后，检查：
□ 所有HLA等位基因格式正确（HLA-X*##:##）
□ 疾病类型拼写正确
□ 没有明显的复制粘贴错误
□ 至少填写了hla_alleles或diseases字段之一


七、常见问题
--------------------------------------------------------------------------------

Q1: 如果SysteMHC页面加载很慢或失败怎么办？
A: 刷新页面或稍后再试。如果持续失败，可以在notes列标注并跳过。

Q2: 如果表格为空怎么办？
A: 标注在notes列："No data in SysteMHC table"，并跳过该数据集。

Q3: 如果不确定疾病类型怎么办？
A: 优先参考数据集标题，实在不确定可以留空或写"Unknown"。

Q4: 需要填写所有38个数据集吗？
A: 建议至少填写27个疾病类型为Unknown的数据集，这样改善效果最明显。

Q5: 填写错误了怎么办？
A: 在CSV中直接修改，然后重新运行merge_manual_systemhc.py即可。


八、快捷技巧
--------------------------------------------------------------------------------

1. 浏览器快捷键：
   • Ctrl+C: 复制
   • Ctrl+T: 新标签页
   • Ctrl+W: 关闭标签

2. Excel快捷键：
   • Ctrl+D: 向下填充（对于重复值）
   • F2: 编辑单元格

3. 批量操作：
   • 对于相同研究的多个数据集，可以参考第一个的填写
   • 相同细胞系的数据集，HLA等位基因可能相同


九、需要帮助？
--------------------------------------------------------------------------------

如果遇到问题：
1. 查看自动化报告：data/validation/systemhc_automation_summary.txt
2. 参考原始数据：data/processed/all_metadata_crosschecked.csv
3. 检查SysteMHC主页：https://systemhc.sjtu.edu.cn/

================================================================================
预祝填写顺利！完成后数据质量将大幅提升！
================================================================================
